<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/views/tradeXchart.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/views/tradeXchart.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// tradeXchart.js
// &lt;tradex-chart>&lt;/tradex-chart>

import element from "./classes/element"
import { debounce } from "../../utils/utilities"
import { isNumber, isObject, isString } from "../../utils/typeChecks"

import tradeXBody from "./body"
import tradeXUtils from "./utils"
import tradeXwidgets from "./widgets"

import {
  UTILSH,
  TOOLSW,
  TIMEH,
  SCALEW,
  CHART_MINH, 
  CHART_MINW, 
} from "../../definitions/style"
import {
  GlobalStyle, GridStyle, XAxisStyle, YAxisStyle
} from "../../definitions/style"

const HTML = `
  &lt;style title="core">
    tradex-utils {
      height: ${UTILSH}px; 
      width: 100%; 
    }
    tradex-body {
      position: relative;
      height: calc(100% - ${UTILSH}px); 
      width: 100%;
    }
    tradex-widgets {
      position: relative;
    }
  &lt;/style>
  &lt;div style="display: none;">
    &lt;slot>&lt;/slot>
  &lt;/div>
  &lt;tradex-utils>&lt;/tradex-utils>
  &lt;tradex-body>&lt;/tradex-body>
  &lt;tradex-widgets>&lt;/tradex-widgets>
`


export default class tradeXChart extends element {

  #elBody
  #elUtils
  #elWidgets
  #template
  #chartW = CHART_MINW
  #chartH = CHART_MINH
  #oWidth
  #oHeight
  #widthCache
  #heightCache

  constructor () {
    const template = document.createElement('template')
          template.innerHTML = HTML
    super(template, "closed")
    this.#template = template
  }

  destroy() {
    this.resizeObserver.disconnect()
  }

  static get observedAttributes() {
    return ['config', 'disabled', 'height', 'stream', 'width']
  }

  connectedCallback() {
    // element building must be done here
    // https://stackoverflow.com/a/43837330/15109215
    if (this.doInit) {
      this.doInit = false
      this.shadowRoot.appendChild(this.#template.content.cloneNode(true))
      this.style.display = "block"

      this.elWidgetsG = this.shadowRoot.querySelector('tradex-widgets')
      this.elUtils = this.shadowRoot.querySelector('tradex-utils')
      this.elBody = this.shadowRoot.querySelector('tradex-body')
      this.elMain = this.elBody.main
      this.elTime = this.elBody.main.time
      this.elTools = this.elBody.tools 
      this.elYAxis = this.elBody.scale

      this.previousDimensions()

      // set the width and height
      let height = this.getAttribute('height') || "100%"
      let width = this.getAttribute('width') || "100%"

      this.setDimensions(width, height)

      this.resizeObserver = new ResizeObserver(debounce(this.onResized, 50, this))
      this.resizeObserver.observe(this)      
    }
  }

  disconnectedCallback() {

    this.resizeObserver.disconnect()

    this.removeEventListener('click', this.onClick)
  }

  attributeChangedCallback(prop, oldVal, newVal) {
    switch(prop) {
      case "config":
        break;
      case "disabled":
        break;
      case "height":
        this.height(newVal)
        break;
      case "width":
        this.width(newVal)
        break;
        case "stream":
          break;
      default:
        break;
    }
  }

  get id() { return this.getAttribute('id'); }
  set id(id) { this.setAttribute('id', id); }

  get disabled() { return this.hasAttribute('disabled'); }
  set disabled(d) {
    if (d) {
        this.setAttribute('disabled', '');
    } else {
        this.removeAttribute('disabled');
    }
  }
  
  get width() { return this.offsetWidth }
  set width(w) { this.setWidth(w) } 
  get height() { return this.offsetHeight }
  set height(h) { this.setHeight(h) }
  get oWidth() { return this.#oWidth }
  get oHeight() { return this.#oHeight }
  get widthDeltaR() { return this.offsetWidth / this.#oWidth }
  get heightDeltaR() { return this.offsetHeight / this.#oHeight }

  get stream() {  }
  set stream(s) {  }

  get body() { return this.#elBody }
  get utils() { return this.#elUtils }
  get widgets() { return this.#elWidgets }


  onResized(entries) {
    // window.requestAnimationFrame(() => {
      console.log("onResize")
      console.log(this.offsetWidth)
      console.log(this.offsetHeight)

      if (isObject(this.MainPane) &amp;&amp; this.MainPane.constructor.name === "MainPane") {
        this.previousDimensions()
        this.emit("global_resize", {w: this.offsetWidth, h: this.offsetHeight}) 
      }
    // })
  }

  previousDimensions() {
    this.#oWidth = (this.#widthCache) ? this.#widthCache : this.offsetWidth
    this.#oHeight = (this.#heightCache) ? this.#heightCache : this.offsetHeight
    this.#widthCache = this.offsetWidth
    this.#heightCache = this.offsetHeight
  }

  setWidth(w) {
    if (isNumber(w)) {
      this.#chartW = w
      w += "px"
    }
    else if (isString(w)) {
      // TODO: regex guard
      // TODO: fallback w = "100%"
    }
    else {
      this.#chartW = this.parentElement.getBoundingClientRect().width
      w = this.#chartW + "px"
    }
    this.style.width = w
  }

  setHeight(h) {
    if (isNumber(h)) {
      this.#chartH = h
      h += "px"
    }
    else if (isString(h)) {
      // TODO: regex guard
      // TODO: fallback w = "100%"
    }
    else {
      this.#chartH = this.parentElement.getBoundingClientRect().height
      w = this.#chartH + "px"
    }
    this.style.height = h
  }

  setWidthMin(w) { this.style.minWidth = `var(--txc-min-width, ${w})` }
  setHeightMin(h) { this.style.minHeight = `var(--txc-min-height, ${w})` }
  setWidthMax(w) { this.style.minWidth = `var(--txc-max-width, ${w})` }
  setHeightMax(h) { this.style.minHeight = `var(--txc-max-height, ${w})` }

  /**
   * Set chart width and height
   * @param {number} w - width in pixels
   * @param {number} h - height in pixels
   * @memberof TradeXchart
   */
  setDimensions(w, h) {
    let dims
    // old values
    let width = this.width
    let height = this.height

    // otherwise use a fallback width and height
    if (!w || !h) {
      const dims = this.getBoundingClientRect()
      const parent = this.parentElement.getBoundingClientRect()

      h = (!dims.height) ? (!parent.height) ? CHART_MINH : parent.height : dims.height;
      w = (!dims.width) ? (!parent.width) ? CHART_MINW : parent.width : dims.width;
    }

    dims = {
      width: this.width,
      height: this.height,
      resizeW: w / width,
      resizeH: h / height,
      resizeWDiff: w - width,
      resizeHDiff: h - height
    }

    this.setWidth(w)
    this.setHeight(h)

    return dims
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Axis.html">Axis</a></li><li><a href="Colour.html">Colour</a></li><li><a href="DMI.module.exports.html">module.exports</a></li><li><a href="EMA.module.exports.html">module.exports</a></li><li><a href="Hit.html">Hit</a></li><li><a href="indicator.html">indicator</a></li><li><a href="Layer.html">Layer</a></li><li><a href="MainPane.html">MainPane</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="Node.html">Node</a></li><li><a href="RSI.html">RSI</a></li><li><a href="RSI.module.exports.html">module.exports</a></li><li><a href="ScaleBar.html">ScaleBar</a></li><li><a href="Scene.html">Scene</a></li><li><a href="StateMachine.html">StateMachine</a></li><li><a href="ToolsBar.html">ToolsBar</a></li><li><a href="TradeXchart.html">TradeXchart</a></li><li><a href="TradeXchart.module.exports.html">module.exports</a></li><li><a href="Viewport.html">Viewport</a></li><li><a href="WebWorker.html">WebWorker</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addOffChart">addOffChart</a></li><li><a href="global.html#addTool">addTool</a></li><li><a href="global.html#binarySearch">binarySearch</a></li><li><a href="global.html#binarySearchNearest">binarySearchNearest</a></li><li><a href="global.html#bRound">bRound</a></li><li><a href="global.html#calcIndicator">calcIndicator</a></li><li><a href="global.html#calcIndicatorStream">calcIndicatorStream</a></li><li><a href="global.html#calcTextWidth">calcTextWidth</a></li><li><a href="global.html#calcTimeIndex">calcTimeIndex</a></li><li><a href="global.html#CandleType">CandleType</a></li><li><a href="global.html#CHART_MINH">CHART_MINH</a></li><li><a href="global.html#checkType">checkType</a></li><li><a href="global.html#copyDeep">copyDeep</a></li><li><a href="global.html#countDigits">countDigits</a></li><li><a href="global.html#createFont">createFont</a></li><li><a href="global.html#day_start">day_start</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#decimalPlaces">decimalPlaces</a></li><li><a href="global.html#destroy">destroy</a></li><li><a href="global.html#detectInterval">detectInterval</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#drawTextBG">drawTextBG</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#firstItemInMap">firstItemInMap</a></li><li><a href="global.html#float2Int">float2Int</a></li><li><a href="global.html#get_day">get_day</a></li><li><a href="global.html#get_month">get_month</a></li><li><a href="global.html#get_year">get_year</a></li><li><a href="global.html#getPixelRatio">getPixelRatio</a></li><li><a href="global.html#getPrecision">getPrecision</a></li><li><a href="global.html#getRandom">getRandom</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getRandomIntBetween">getRandomIntBetween</a></li><li><a href="global.html#getRandomIntInclusive">getRandomIntInclusive</a></li><li><a href="global.html#getTextRectHeight">getTextRectHeight</a></li><li><a href="global.html#getTextRectWidth">getTextRectWidth</a></li><li><a href="global.html#hex">hex</a></li><li><a href="global.html#hexa">hexa</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#index10">index10</a></li><li><a href="global.html#insertAtIndex">insertAtIndex</a></li><li><a href="global.html#interval2MS">interval2MS</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isBoolean">isBoolean</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#isValid">isValid</a></li><li><a href="global.html#isValidCandle">isValidCandle</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#loadState">loadState</a></li><li><a href="global.html#log10">log10</a></li><li><a href="global.html#mean">mean</a></li><li><a href="global.html#mergeDeep">mergeDeep</a></li><li><a href="global.html#month_start">month_start</a></li><li><a href="global.html#ms2TimeUnits">ms2TimeUnits</a></li><li><a href="global.html#nearestArrayValue">nearestArrayValue</a></li><li><a href="global.html#nice">nice</a></li><li><a href="global.html#numDigits">numDigits</a></li><li><a href="global.html#numDigits2">numDigits2</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#power">power</a></li><li><a href="global.html#precision">precision</a></li><li><a href="global.html#price2YPos">price2YPos</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#renderClosedFillPath">renderClosedFillPath</a></li><li><a href="global.html#renderClosedStrokePath">renderClosedStrokePath</a></li><li><a href="global.html#renderFilledCircle">renderFilledCircle</a></li><li><a href="global.html#renderFilledDiamond">renderFilledDiamond</a></li><li><a href="global.html#renderFilledTriangle">renderFilledTriangle</a></li><li><a href="global.html#renderFillRect">renderFillRect</a></li><li><a href="global.html#renderFillRoundRect">renderFillRoundRect</a></li><li><a href="global.html#renderHorizontalLine">renderHorizontalLine</a></li><li><a href="global.html#renderLine">renderLine</a></li><li><a href="global.html#renderPath">renderPath</a></li><li><a href="global.html#renderRoundRect">renderRoundRect</a></li><li><a href="global.html#renderStrokedCircle">renderStrokedCircle</a></li><li><a href="global.html#renderStrokeFillRoundRect">renderStrokeFillRoundRect</a></li><li><a href="global.html#renderStrokeRoundRect">renderStrokeRoundRect</a></li><li><a href="global.html#renderText">renderText</a></li><li><a href="global.html#renderVerticalLine">renderVerticalLine</a></li><li><a href="global.html#replacer">replacer</a></li><li><a href="global.html#resize">resize</a></li><li><a href="global.html#reviver">reviver</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#saveState">saveState</a></li><li><a href="global.html#setDimensions">setDimensions</a></li><li><a href="global.html#setHex">setHex</a></li><li><a href="global.html#setHSLA">setHSLA</a></li><li><a href="global.html#setPriceVolumePrecision">setPriceVolumePrecision</a></li><li><a href="global.html#setRGBA">setRGBA</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#throttle">throttle</a></li><li><a href="global.html#time2XPos">time2XPos</a></li><li><a href="global.html#timestampDifference">timestampDifference</a></li><li><a href="global.html#updateLegends">updateLegends</a></li><li><a href="global.html#updateRange">updateRange</a></li><li><a href="global.html#validateConfig">validateConfig</a></li><li><a href="global.html#validateShallow">validateShallow</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#weave">weave</a></li><li><a href="global.html#YAxisPosition">YAxisPosition</a></li><li><a href="global.html#YAxisType">YAxisType</a></li><li><a href="global.html#year_start">year_start</a></li><li><a href="global.html#zoomRange">zoomRange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Sat Mar 11 2023 22:32:46 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
