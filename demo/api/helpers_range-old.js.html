<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: helpers/range-old.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: helpers/range-old.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// range.js

import indicators from "../definitions/indicators"
import { DAY_MS, ms2Interval, WEEK_MS } from "../utils/time"
import { LIMITFUTURE, LIMITPAST, MINCANDLES, YAXIS_BOUNDS } from "../definitions/chart"
import { isNumber, isObject } from "../utils/typeChecks"
import { limit } from "../utils/number"
// import { Range } from "./range2"

const config = {
  limitFuture: LIMITFUTURE,
  limitPast: LIMITPAST,
  minCandles: MINCANDLES,
  yAxisBounds: YAXIS_BOUNDS
}

export function getRange( allData, start=0, end=allData.data.length-1, config={} ) {
  if (!isObject(allData) || 
      !isNumber(start) || 
      !isNumber(end) || 
      !isObject(config)) return false

  // let r = new Range( allData, start=0, end=allData.data.length-1, config={} )
  let r = {}
  // let r = rx

  r = {...r, ...allData}
  Object.defineProperty(r, 'dataLength', { get() { return this.data.length - 1 } })

  // check and correct start and end argument order
  if (start > end) [start, end] = [end, start]

  // minimum range constraint
  if ((end - start) &lt; MINCANDLES) end = start + MINCANDLES + 1

  // set out of history bounds limits
  start = (start &lt; LIMITPAST * -1) ? LIMITPAST * -1 : start
  end = (end &lt; (LIMITPAST * -1) + MINCANDLES) ? (LIMITPAST * -1) + MINCANDLES + 1 : end
  start = (start > r.dataLength + LIMITFUTURE - MINCANDLES) ? r.dataLength + LIMITFUTURE - MINCANDLES - 1: start
  end = (end > r.dataLength + LIMITFUTURE) ? r.dataLength + LIMITFUTURE : end
  
  r.value = (index) => { return rangeValue(index, r)}
  r.index = (ts) => { return getTimeIndex(ts, r) }
  r.inRange = (ts) => { return inRange(ts, r) }
  r.inPriceHistory = (ts) => { return inRange(ts, r) }
  r.rangeIndex = (ts) => { return getTimeIndex(ts, r) - r.indexStart }
  r.interval = r.data[1][0] - r.data[0][0]
  r.intervalStr = ms2Interval(r.interval)
  r.indexStart = start
  r.indexEnd = end
  r.Length = r.indexEnd - r.indexStart
  Object.defineProperty(r, 'timeStart', { get() { return this.value(0)[0] } })
  Object.defineProperty(r, 'timeFinish', { get() { return this.value(this.dataLength)[0] } })

  r.timeDuration = r.timeFinish - r.timeStart
  r.timeMin = r.value(r.indexStart)[0]
  r.timeMax = r.value(r.indexEnd)[0]
  r.rangeDuration = r.timeMax - r.timeMin
  // r = {...r, ...maxMinPriceVol(r.data, r.indexStart, r.indexEnd)}
  r = Object.defineProperties({}, {
    ...Object.getOwnPropertyDescriptors(r),
    ...Object.getOwnPropertyDescriptors(maxMinPriceVol(r.data, r.indexStart, r.indexEnd)),
  });
  r.height = r.priceMax - r.priceMin
  r.volumeHeight = r.volumeMax - r.volumeMin
  r.scale = (r.Length) / (r.dataLength)
  return r
}

class Range {

}

let r = {
  data: {},
  _interval: 0,
  _intervalStr: "",

  get dataLength () { this.data.length - 1 },
  get Length () { return  this.indexEnd - this.indexStart },
  get timeDuration () { return this.timeFinish - this.timeStart },
  get timeMin () { return this.value(this.indexStart)[0] },
  get timeMax () { return this.value(this.indexEnd)[0] },
  get rangeDuration () { return this.timeMax - this.timeMin },
  get timeStart () { return this.value(0)[0] },
  get timeFinish () { return this.value(this.dataLength)[0] },
  set interval (i) { this._interval = i },
  get interval () { return this._interval },
  set intervalStr (i) { this._intervalStr = i },
  get intervalStr () { return this._intervalStr },

  value: (index) => { return rangeValue(index, this)},
  index: (ts) => { return getTimeIndex(ts, this) },
  inRange: (ts) => { return inRange(ts, this) },
  inPriceHistory: (ts) => { return inRange(ts, this) },
  rangeIndex: (ts) => { return getTimeIndex(ts, this) - this.indexStart },
}

export function inPriceHistory(t, range) {
  if (t >= range.timeStart &amp;&amp; t &lt;= range.timeFinish)
    return true
  else return false
}

export function inRange(t, range) {
  if (t >= range.timeMin &amp;&amp; t &lt;= range.timeMax)
    return true
  else return false
}

export function rangeValue( index, range ) {
  // return last value as default
  if (!isNumber(index)) index = range.data.length - 1

  let v = range.data[index]
  if (v !== undefined) return v
  else {
    const len = range.data.length - 1
    v = [null, null, null, null, null, null]
    if (index &lt; 0) {
      v[0] = range.data[0][0] + (range.interval * index)
      return v
    }
    else if (index > len) {
      v[0] = range.data[len][0] + (range.interval * (index - len))
      return v
    }
    else return null
  }
}

export function rangeOnchartValue( range, indicator, index ) {
  const len = range.onchart[indicator].length - 1
  const value = null
}

export function rangeOffchartValue( range, indicator, index ) {
}

export function rangeDatasetValue( range, indicator, index ) {
}

/**
 * Find price maximum and minimum, volume maximum and minimum
 *
 * @export
 * @param {array} data
 * @param {number} [start=0]
 * @param {number} [end=data.length-1]
 * @return {object}  
 */
export function maxMinPriceVol( data, start=0, end=data.length-1 ) {

  let l = (data.length-1) ? data.length-1 : 0
  let i = limit(start, 0, l)
  let c = limit(end, 0, l)

  let priceMin  = data[i][3]
  let priceMax  = data[i][2]
  let volumeMin = data[i][5]
  let volumeMax = data[i][5]

  while(i++ &lt; c) {
    priceMin  = (data[i][3] &lt; priceMin) ? data[i][3] : priceMin
    priceMax  = (data[i][2] > priceMax) ? data[i][2] : priceMax
    volumeMin = (data[i][5] &lt; volumeMin) ? data[i][5] : volumeMin
    volumeMax = (data[i][5] > volumeMax) ? data[i][5] : volumeMax
  }

  return {
    priceMin: priceMin * (1 - YAXIS_BOUNDS),
    priceMax: priceMax * (1 + YAXIS_BOUNDS),
    volumeMin: volumeMin,
    volumeMax: volumeMax
  }
}


// Detects candles interval
export function detectInterval(ohlcv) {

  let len = Math.min(ohlcv.length - 1, 99)
  let min = Infinity
  ohlcv.slice(0, len).forEach((x, i) => {
      let d = ohlcv[i+1][0] - x[0]
      if (d === d &amp;&amp; d &lt; min) min = d
  })
  // This saves monthly chart from being awkward
  // if (min >= WEEK_MS * 4 &amp;&amp; min &lt;= DAY_MS * 30) {
  //     return DAY_MS * 31
  // }
  return min
}

export function getTimeIndex(ts, r) {
  // if (r.inRange(ts)) {
  //   let i = r.indexStart
  //   while (i++ &lt;= r.indexEnd) {
  //     if (ts === r.value(i)[0]) return i
  //   }
  //   return false
  // }

  if (!isNumber(ts)) return false
  ts = ts - (ts % r.interval)

  let x = r.data[0][0]
  if (ts === x) 
    return 0
  else if (ts &lt; x)
    return ((x - ts) / r.interval) * -1
  else 
    return (ts - x) / r.interval
}

export function calcTimeIndex(time, dateStamp) {
  if (!isNumber(dateStamp)) return false

  let index
  let timeFrameMS = time.timeFrameMS
  dateStamp = dateStamp - (dateStamp % timeFrameMS)

  if (dateStamp === time.range.data[0][0])
    index = 0
  else if (dateStamp &lt; time.range.data[0][0]) 
    index = ((time.range.data[0][0] - dateStamp) / timeFrameMS) * -1
  else 
    index = (dateStamp - time.range.data[0][0]) / timeFrameMS

  return index
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Axis.html">Axis</a></li><li><a href="Colour.html">Colour</a></li><li><a href="DMI.module.exports.html">module.exports</a></li><li><a href="Hit.html">Hit</a></li><li><a href="indicator.html">indicator</a></li><li><a href="Layer.html">Layer</a></li><li><a href="MainPane.html">MainPane</a></li><li><a href="module.exports_module.exports.html">exports</a></li><li><a href="RSI.html">RSI</a></li><li><a href="RSI.module.exports.html">module.exports</a></li><li><a href="ScaleBar.html">ScaleBar</a></li><li><a href="Scene.html">Scene</a></li><li><a href="StateMachine.html">StateMachine</a></li><li><a href="ToolsBar.html">ToolsBar</a></li><li><a href="TradeXchart.html">TradeXchart</a></li><li><a href="TradeXchart.module.exports.html">module.exports</a></li><li><a href="Viewport.html">Viewport</a></li><li><a href="WebWorker.html">WebWorker</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addOffChart">addOffChart</a></li><li><a href="global.html#addTool">addTool</a></li><li><a href="global.html#binarySearch">binarySearch</a></li><li><a href="global.html#binarySearchNearest">binarySearchNearest</a></li><li><a href="global.html#calcIndicator">calcIndicator</a></li><li><a href="global.html#calcIndicatorStream">calcIndicatorStream</a></li><li><a href="global.html#calcTextWidth">calcTextWidth</a></li><li><a href="global.html#calcTimeIndex">calcTimeIndex</a></li><li><a href="global.html#CandleType">CandleType</a></li><li><a href="global.html#checkType">checkType</a></li><li><a href="global.html#copyDeep">copyDeep</a></li><li><a href="global.html#countDigits">countDigits</a></li><li><a href="global.html#createFont">createFont</a></li><li><a href="global.html#day_start">day_start</a></li><li><a href="global.html#decimalPlaces">decimalPlaces</a></li><li><a href="global.html#destroy">destroy</a></li><li><a href="global.html#detectInterval">detectInterval</a></li><li><a href="global.html#draw">draw</a></li><li><a href="global.html#drawTextBG">drawTextBG</a></li><li><a href="global.html#emit">emit</a></li><li><a href="global.html#end">end</a></li><li><a href="global.html#execute">execute</a></li><li><a href="global.html#float2Int">float2Int</a></li><li><a href="global.html#get_day">get_day</a></li><li><a href="global.html#get_month">get_month</a></li><li><a href="global.html#get_year">get_year</a></li><li><a href="global.html#getPixelRatio">getPixelRatio</a></li><li><a href="global.html#getPrecision">getPrecision</a></li><li><a href="global.html#getRandom">getRandom</a></li><li><a href="global.html#getRandomInt">getRandomInt</a></li><li><a href="global.html#getRandomIntBetween">getRandomIntBetween</a></li><li><a href="global.html#getRandomIntInclusive">getRandomIntInclusive</a></li><li><a href="global.html#getRange">getRange</a></li><li><a href="global.html#getTextRectHeight">getTextRectHeight</a></li><li><a href="global.html#getTextRectWidth">getTextRectWidth</a></li><li><a href="global.html#GlobalStyle">GlobalStyle</a></li><li><a href="global.html#hex">hex</a></li><li><a href="global.html#hexa">hexa</a></li><li><a href="global.html#id">id</a></li><li><a href="global.html#index10">index10</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#interval2MS">interval2MS</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isBoolean">isBoolean</a></li><li><a href="global.html#isFunction">isFunction</a></li><li><a href="global.html#isNumber">isNumber</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isString">isString</a></li><li><a href="global.html#isValid">isValid</a></li><li><a href="global.html#isValidCandle">isValidCandle</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#loadState">loadState</a></li><li><a href="global.html#log10">log10</a></li><li><a href="global.html#maxMinPriceVol">maxMinPriceVol</a></li><li><a href="global.html#mean">mean</a></li><li><a href="global.html#mergeData">mergeData</a></li><li><a href="global.html#mergeDeep">mergeDeep</a></li><li><a href="global.html#month_start">month_start</a></li><li><a href="global.html#ms2TimeUnits">ms2TimeUnits</a></li><li><a href="global.html#nearestArrayValue">nearestArrayValue</a></li><li><a href="global.html#nice">nice</a></li><li><a href="global.html#numDigits">numDigits</a></li><li><a href="global.html#numDigits2">numDigits2</a></li><li><a href="global.html#off">off</a></li><li><a href="global.html#on">on</a></li><li><a href="global.html#power">power</a></li><li><a href="global.html#precision">precision</a></li><li><a href="global.html#price2YPos">price2YPos</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#renderClosedFillPath">renderClosedFillPath</a></li><li><a href="global.html#renderClosedStrokePath">renderClosedStrokePath</a></li><li><a href="global.html#renderFilledCircle">renderFilledCircle</a></li><li><a href="global.html#renderFilledDiamond">renderFilledDiamond</a></li><li><a href="global.html#renderFilledTriangle">renderFilledTriangle</a></li><li><a href="global.html#renderFillRect">renderFillRect</a></li><li><a href="global.html#renderFillRoundRect">renderFillRoundRect</a></li><li><a href="global.html#renderHorizontalLine">renderHorizontalLine</a></li><li><a href="global.html#renderLine">renderLine</a></li><li><a href="global.html#renderPath">renderPath</a></li><li><a href="global.html#renderRoundRect">renderRoundRect</a></li><li><a href="global.html#renderStrokedCircle">renderStrokedCircle</a></li><li><a href="global.html#renderStrokeFillRoundRect">renderStrokeFillRoundRect</a></li><li><a href="global.html#renderStrokeRoundRect">renderStrokeRoundRect</a></li><li><a href="global.html#renderText">renderText</a></li><li><a href="global.html#renderVerticalLine">renderVerticalLine</a></li><li><a href="global.html#resize">resize</a></li><li><a href="global.html#round">round</a></li><li><a href="global.html#saveState">saveState</a></li><li><a href="global.html#setDimensions">setDimensions</a></li><li><a href="global.html#setPricePrecision">setPricePrecision</a></li><li><a href="global.html#setPriceVolumePrecision">setPriceVolumePrecision</a></li><li><a href="global.html#setRange">setRange</a></li><li><a href="global.html#setStream">setStream</a></li><li><a href="global.html#setTheme">setTheme</a></li><li><a href="global.html#setVolumePrecision">setVolumePrecision</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#stop">stop</a></li><li><a href="global.html#time2XPos">time2XPos</a></li><li><a href="global.html#timestampDifference">timestampDifference</a></li><li><a href="global.html#updateLegends">updateLegends</a></li><li><a href="global.html#updateRange">updateRange</a></li><li><a href="global.html#validateConfig">validateConfig</a></li><li><a href="global.html#validateShallow">validateShallow</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#weave">weave</a></li><li><a href="global.html#YAxisPosition">YAxisPosition</a></li><li><a href="global.html#YAxisType">YAxisType</a></li><li><a href="global.html#year_start">year_start</a></li><li><a href="global.html#zoomRange">zoomRange</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.11</a> on Tue Oct 18 2022 01:23:08 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
